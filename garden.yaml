# Use "cargo install garden-tools" to install garden (https://gitlab.com/garden-rs/garden).
# Usage:
#   garden check
#   garden fmt
#
# Generate documentation
#   garden setup  # One-time setup
#   garden doc
trees:
  telescope-git-selector:
    description: Search for Git worktree and open files or grep in them
    path: ${GARDEN_CONFIG_DIR}
    url: git@gitlab.com:davvid/telescope-git-selector.nvim.git
    remotes:
      github: git@github.com:davvid/telescope-git-selector.nvim.git
    gitconfig:
      remote.publish.pushurl:
        - git@gitlab.com:davvid/telescope-git-selector.nvim.git
        - git@github.com:davvid/telescope-git-selector.nvim.git
    environment:
      PATH: ${GARDEN_CONFIG_DIR}/panvimdoc
    commands:
      check>:
        - check/lua
        - check/fmt
      check/fmt: garden fmt -- --check
      check/lua: luacheck lua/*
      doc: |
        panvimdoc.sh \
          --description ' Search for Git worktree and open files or grep in them' \
          --input-file README.md \
          --project-name ${TREE_NAME} \
          --toc false
      doc>:
        - doc/post
      doc/post: |
        sed -i -e 's/Generated by panvimdoc.*//' doc/${TREE_NAME}.txt
        nvim +'helptags doc | exit'
      fmt: |
        stylua \
          --call-parentheses Always \
          --column-width 88 \
          --indent-type Spaces \
          --quote-style AutoPreferSingle \
          "$@" \
          lua/*/*.lua
      setup: |
        garden -vv grow panvimdoc
        garden -vv setup panvimdoc

  panvimdoc:
    description: Generate vimdoc documentation from pandoc markdown
    url: https://github.com/kdheepak/panvimdoc.git
    commands:
      setup: sudo apt install pandoc
